<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>POCUS SIMULATOR Cardio Practice</title>

  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      text-align: center;
    }

    #bodyDiagram {
      display: grid;
      grid-template-columns: repeat(3, 100px);
      gap: 10px;
      justify-content: center;
      margin: 20px 0;
    }

    .body-region {
      padding: 10px;
      background-color: #eee;
      border: 1px solid #999;
      cursor: pointer;
      border-radius: 5px;
    }

    .highlight {
      background-color: #cce5ff;
    }

    button {
      padding: 10px 15px;
      font-size: 20px;
      margin: 20px;
    }

    img {
      display: none;
      max-width: 90%;
      margin-top: 20px;
      border: 2px solid #ccc;
      border-radius: 10px;
    }

    #orientationData p {
      font-size: 18px;
    }

    #chest-container {
      position: relative;
      display: inline-block;
      margin: 20px;
    }

    #chest-image {
      width: 1000px;
      height: auto;
      border: 1px solid #aaa;
      display: block;
    }
  </style>
</head>

<body>
  <h1>POCUS SIMULATOR Cardio Practice</h1>

  <div id="bodyDiagram">
    <div class="body-region" id="leftOfSternum">Left of Sternum</div>
    <div class="body-region" id="thirdIntercostal">3rd Intercostal Space</div>
    <div class="body-region" id="fifthIntercostal">5th Intercostal Space</div>
    <div class="body-region" id="midClavicular">Mid-Clavicular Line</div>
    <div class="body-region" id="midlineXiphoid">Midline Below Xiphoid</div>
    <div class="body-region" id="rightOfMidline">Right of Midline Below Costal Margin</div>
  </div>


  <button id="enableButton">Enable Orientation</button>
  <button id="setNeutralButton">Set Neutral Orientation</button>

  <div id="orientationData" style="display:none;">
    <p>Alpha (Z): <span id="alpha">0</span></p>
    <p>Beta (X): <span id="beta">0</span></p>
    <p>Gamma (Y): <span id="gamma">0</span></p>
  </div>

  <div id="viewLabel" style="
  display:none;
  font-size: 22px;
  font-weight: bold;
  margin-top: 15px;
  color: #0044cc;
    ">
  </div>

  <!-- Ultrasound images -->
  <img id="cardioImage1" src="Images/Cardio/Cardio_Parasternal_Long_Axis.png" />
  <img id="cardioImage2" src="Images/Cardio/Cardio_Parasternal_Short_Axis.png" />
  <img id="cardioImage3" src="Images/Cardio/Cardio_Apical 4 Chamber.png" />
  <img id="cardioImage4" src="Images/Cardio/Cardio_Subcostal 4 Chamber.png" />
  <img id="cardioImage5" src="Images/Cardio/Cardio_Subcostal Inferior Vena Cava.png" />

<script>
let neutralOrientation = { alpha: 0, beta: 0, gamma: 0 };
let lastOrientation = null;
let currentImageShown = null;

let smoothAlpha = 0;
let smoothBeta = 0;
let smoothGamma = 0;
const smoothingFactor = 0.15; // lower = smoother (0.05â€“0.2 is ideal)

const selectedPosition = {
  leftOfSternum: false,
  thirdIntercostal: false,
  fifthIntercostal: false,
  midClavicular: false,
  midlineXiphoid: false,
  rightOfMidline: false
};

function toggleRegion(id) {
  const region = document.getElementById(id);
  region.addEventListener("click", () => {
    selectedPosition[id] = !selectedPosition[id];
    region.classList.toggle("highlight");
  });
}

["leftOfSternum", "thirdIntercostal", "fifthIntercostal", "midClavicular", "midlineXiphoid", "rightOfMidline"]
  .forEach(toggleRegion);

// Set neutral orientation
document.getElementById("setNeutralButton").addEventListener("click", () => {
  if (lastOrientation) {
    neutralOrientation.alpha = lastOrientation.alpha || 0;
    neutralOrientation.beta = lastOrientation.beta || 0;
    neutralOrientation.gamma = lastOrientation.gamma || 0;
    alert("Neutral orientation set!");
  }
});

function handleOrientation(event) {
  lastOrientation = event;

  const alpha = (event.alpha || 0) - neutralOrientation.alpha;
  const beta = (event.beta || 0) - neutralOrientation.beta;
  const gamma = (event.gamma || 0) - neutralOrientation.gamma;

  smoothAlpha += (alpha - smoothAlpha) * smoothingFactor;
  smoothBeta  += (beta  - smoothBeta)  * smoothingFactor;
  smoothGamma += (gamma - smoothGamma) * smoothingFactor;

  document.getElementById("alpha").textContent = alpha.toFixed(1);
  document.getElementById("beta").textContent = beta.toFixed(1);
  document.getElementById("gamma").textContent = gamma.toFixed(1);

  const viewLabel = document.getElementById("viewLabel");

  function showView(labelText) {
  viewLabel.textContent = labelText;
  viewLabel.style.display = "block";
}

  function hideView() {
  viewLabel.style.display = "none";
}


  const images = [
    "cardioImage1", "cardioImage2", "cardioImage3", "cardioImage4", "cardioImage5"
  ].map(id => document.getElementById(id));

  images.forEach(img => img.style.display = "none");

  let shown = null;

  if (selectedPosition.leftOfSternum && selectedPosition.thirdIntercostal &&
      smoothBeta >= 70 && smoothBeta <= 110 &&
      (smoothAlpha >= 300 || smoothAlpha <= 20)
      )
  {
    images[0].style.display = "block"; 
    shown = "image1" ;
    showView("Parasternal Long Axis (PLAX)");
  } 
  else if (selectedPosition.leftOfSternum && selectedPosition.thirdIntercostal && 
           smoothBeta >= 75 && smoothBeta <= 100 && 
           (smoothAlpha >= 10 && smoothAlpha <= 45) 
  )
  {
    images[1].style.display = "block"; 
    shown = "image2";
    showView("Parasternal Short Axis (PSAX)");
  } 
  else if (selectedPosition.fifthIntercostal && selectedPosition.midClavicular && 
           smoothBeta >= 75 && smoothBeta <= 110 && 
           (smoothAlpha >= 50 && smoothAlpha <= 100) 
  )
  {
    images[2].style.display = "block"; 
    shown = "image3";
    showView("Apical 4 Chamber (A4C)");
  } 
  else if (selectedPosition.midlineXiphoid && smoothBeta >= 75 && smoothBeta <= 100 && 
           (smoothAlpha >= 190 && smoothAlpha <= 220) 
  )
  {
    images[3].style.display = "block"; 
    shown = "image4";
    showView("Subcostal 4 Chamber (SC4C)");
  } 
  else if (selectedPosition.rightOfMidline && smoothBeta >= 75 && smoothBeta <= 100 && 
           (smoothAlpha >= 350 || smoothAlpha <= 10)) {
    images[4].style.display = "block"; 
    shown = "image5";
    showView("IVC");
  }

  if (shown && shown !== currentImageShown) {
    if (navigator.vibrate) navigator.vibrate(200);
    currentImageShown = shown;
  } else if (!shown) {
    currentImageShown = null;
  }
  if (!shown) {
  currentImageShown = null;
  hideView();
}
}

function enableOrientationTracking() {
  const dataDiv = document.getElementById("orientationData");
  const enableButton = document.getElementById("enableButton");

  if (
    typeof DeviceOrientationEvent !== 'undefined' &&
    typeof DeviceOrientationEvent.requestPermission === 'function'
  ) {
    DeviceOrientationEvent.requestPermission().then(permissionState => {
      if (permissionState === 'granted') {
        window.addEventListener('deviceorientation', handleOrientation);
        dataDiv.style.display = 'block';
        enableButton.style.display = 'none';
      }
    }).catch(console.error);
  } else {
    window.addEventListener('deviceorientation', handleOrientation);
    dataDiv.style.display = 'block';
    enableButton.style.display = 'none';
  }
}

document.getElementById("enableButton").addEventListener("click", enableOrientationTracking);
</script>

</body>
</html>
