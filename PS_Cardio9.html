<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>POCUS SIMULATOR Cardio Practice</title>

  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      text-align: center;
    }

    #bodyDiagram {
      display: grid;
      grid-template-columns: repeat(3, 100px);
      gap: 10px;
      justify-content: center;
      margin: 20px 0;
    }

    .body-region {
      padding: 10px;
      background-color: #eee;
      border: 1px solid #999;
      cursor: pointer;
      border-radius: 5px;
    }

    .highlight {
      background-color: #cce5ff;
    }

    button {
      padding: 10px 15px;
      font-size: 20px;
      margin: 20px;
    }

    img {
      display: none;
      max-width: 90%;
      margin-top: 20px;
      border: 2px solid #ccc;
      border-radius: 10px;
    }

    #orientationData p {
      font-size: 18px;
    }

    #chest-container {
      position: relative;
      display: inline-block;
      margin: 20px;
    }

    #chest-image {
      width: 1000px;
      height: auto;
      border: 1px solid #aaa;
      display: block;
    }
  </style>
</head>

<body>
  <h1>POCUS SIMULATOR Cardio Practice</h1>

  <div id="bodyDiagram">
    <div class="body-region" id="leftOfSternum">Left of Sternum</div>
    <div class="body-region" id="thirdIntercostal">3rd Intercostal Space</div>
    <div class="body-region" id="fifthIntercostal">5th Intercostal Space</div>
    <div class="body-region" id="midClavicular">Mid-Clavicular Line</div>
    <div class="body-region" id="midlineXiphoid">Midline Below Xiphoid</div>
    <div class="body-region" id="rightOfMidline">Right of Midline Below Costal Margin</div>
  </div>


  <button id="enableButton">Enable Orientation</button>
  <button id="setNeutralButton">Set Neutral Orientation</button>

  <div id="orientationData" style="display:none;">
    <p>Alpha (Z): <span id="alpha">0</span></p>
    <p>Beta (X): <span id="beta">0</span></p>
    <p>Gamma (Y): <span id="gamma">0</span></p>
  </div>

  <div id="viewLabel" style="
  display:none;
  font-size: 22px;
  font-weight: bold;
  margin-top: 15px;
  color: #0044cc;
    ">
  </div>

  <!-- Ultrasound images -->
  <img id="cardioImage1" src="Images/Cardio/Cardio_Parasternal_Long_Axis.png" />
  <img id="cardioImage2" src="Images/Cardio/Cardio_Parasternal_Short_Axis.png" />
  <img id="cardioImage3" src="Images/Cardio/Cardio_Apical 4 Chamber.png" />
  <img id="cardioImage4" src="Images/Cardio/Cardio_Subcostal 4 Chamber.png" />
  <img id="cardioImage5" src="Images/Cardio/Cardio_Subcostal Inferior Vena Cava.png" />

<script>
  
document.addEventListener("DOMContentLoaded", () => {
  
let viewLocked = false;
let viewLockTimer = null;

let neutralOrientation = { alpha: 0, beta: 0, gamma: 0 };
let lastOrientation = null;
let currentImageShown = null;

let smoothAlpha = 0;
let smoothBeta = 0;
let smoothGamma = 0;
const smoothingFactor = 0.15; // lower = smoother (0.05â€“0.2 is ideal)

const selectedPosition = {
  leftOfSternum: false,
  thirdIntercostal: false,
  fifthIntercostal: false,
  midClavicular: false,
  midlineXiphoid: false,
  rightOfMidline: false
};
  
function showView(imageElement, viewName) {
  if (viewLocked) return;

  viewLocked = true;

  // Hide all images
  //images.forEach(img => img.style.display = "none");

  // Show selected image
  imageElement.style.display = "block";

  // Show label
  const viewLabel = document.getElementById("viewLabel");
  viewLabel.textContent = viewName;
  viewLabel.style.display = "block";

  // Unlock after 1 second
  setTimeout(() => {
    viewLocked = false;
  }, 1000);
}

function toggleRegion(id) {
  const region = document.getElementById(id);
  region.addEventListener("click", () => {
    selectedPosition[id] = !selectedPosition[id];
    region.classList.toggle("highlight");
  });
}

["leftOfSternum", "thirdIntercostal", "fifthIntercostal", "midClavicular", "midlineXiphoid", "rightOfMidline"]
  .forEach(toggleRegion);

// Set neutral orientation
document.getElementById("setNeutralButton").addEventListener("click", () => {
  if (lastOrientation) {
    neutralOrientation.alpha = lastOrientation.alpha || 0;
    neutralOrientation.beta = lastOrientation.beta || 0;
    neutralOrientation.gamma = lastOrientation.gamma || 0;
    alert("Neutral orientation set!");
  }
});

function handleOrientation(event) {

  lastOrientation = event;

  const alpha = (event.alpha || 0) - neutralOrientation.alpha;
  const beta  = (event.beta  || 0) - neutralOrientation.beta;
  const gamma = (event.gamma || 0) - neutralOrientation.gamma;

  smoothAlpha += (alpha - smoothAlpha) * smoothingFactor;
  smoothBeta  += (beta  - smoothBeta)  * smoothingFactor;
  smoothGamma += (gamma - smoothGamma) * smoothingFactor;

  document.getElementById("alpha").textContent = smoothAlpha.toFixed(1);
  document.getElementById("beta").textContent  = smoothBeta.toFixed(1);
  document.getElementById("gamma").textContent = smoothGamma.toFixed(1);

  // ----- VIEW LOGIC -----

  if (viewLocked) return;  // lock only affects switching, not orientation

  if (selectedPosition.leftOfSternum && selectedPosition.thirdIntercostal &&
      smoothBeta >= 70 && smoothBeta <= 110 &&
      (smoothAlpha >= 300 || smoothAlpha <= 20)) {

    showView(images[0], "Parasternal Long Axis (PLAX)");
  }

  else if (selectedPosition.leftOfSternum && selectedPosition.thirdIntercostal && 
           smoothBeta >= 75 && smoothBeta <= 100 && 
           (smoothAlpha >= 10 && smoothAlpha <= 45)) {

    showView(images[1], "Parasternal Short Axis (PSAX)");
  }

  else if (selectedPosition.fifthIntercostal && selectedPosition.midClavicular && 
           smoothBeta >= 75 && smoothBeta <= 110) {

    showView(images[2], "Apical 4 Chamber (A4C)");
  }

  else if (selectedPosition.midlineXiphoid && 
           smoothBeta >= 75 && smoothBeta <= 100 && 
           (smoothAlpha >= 190 && smoothAlpha <= 220)) {

    showView(images[3], "Subcostal 4 Chamber (SC4C)");
  }

  else if (selectedPosition.rightOfMidline && 
           smoothBeta >= 75 && smoothBeta <= 100 && 
           (smoothAlpha >= 350 || smoothAlpha <= 10)) {

    showView(images[4], "Inferior Vena Cava (IVC)");
  }
}

function enableOrientationTracking() {
  const dataDiv = document.getElementById("orientationData");
  const enableButton = document.getElementById("enableButton");

  if (
    typeof DeviceOrientationEvent !== 'undefined' &&
    typeof DeviceOrientationEvent.requestPermission === 'function'
  ) {
    DeviceOrientationEvent.requestPermission().then(permissionState => {
      if (permissionState === 'granted') {
        window.addEventListener('deviceorientation', handleOrientation);
        dataDiv.style.display = 'block';
        enableButton.style.display = 'none';
      }
    }).catch(console.error);
  } else {
    window.addEventListener('deviceorientation', handleOrientation);
    dataDiv.style.display = 'block';
    enableButton.style.display = 'none';
  }
}

document.getElementById("enableButton").addEventListener("click", enableOrientationTracking);

  });
</script>

</body>
</html>
